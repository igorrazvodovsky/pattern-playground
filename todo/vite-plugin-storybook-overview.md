# Vite Plugin: Auto-Generate Storybook Category Overviews

## Overview
Create a Vite plugin that automatically generates overview pages for each Storybook category (primitives, components, compositions, patterns, concepts, foundations) by scanning the respective directories and creating lists of available stories.

## Problem Statement
Currently, category overview pages like `src/stories/primitives/Overview.mdx` need to be manually updated when new components are added. This leads to:
- Forgotten updates when adding new components
- Outdated documentation
- Manual maintenance overhead

## Solution Architecture

### 1. Plugin Structure
```
plugins/
└── storybook-overview-generator/
    ├── index.ts (main plugin entry)
    ├── scanner.ts (directory scanning logic)
    ├── generator.ts (MDX content generation)
    ├── templates/ (MDX templates for each category)
    │   ├── primitives.template.mdx
    │   ├── components.template.mdx
    │   ├── compositions.template.mdx
    │   ├── patterns.template.mdx
    │   ├── concepts.template.mdx
    │   └── foundations.template.mdx
    └── types.ts (TypeScript definitions)
```

### 2. Core Functionality

#### Directory Scanner (`scanner.ts`)
- Scan `src/stories/` directory structure
- Identify category directories: primitives, components, compositions, patterns, concepts, foundations
- Extract story metadata from:
  - `.mdx` files (Meta title, description from frontmatter)
  - `.stories.tsx` files (Meta export, story titles)
  - Nested directories (like `patterns/intelligence/Prompt/`)
- Handle special cases:
  - Files marked with `*` (work in progress)
  - Nested pattern categories
  - Mixed file types (.mdx, .stories.tsx, .md)

#### Content Generator (`generator.ts`)
- Generate MDX content for each category overview
- Create categorised lists with:
  - Story title (extracted from Meta)
  - Brief description (from first paragraph or frontmatter)
  - Storybook link (formatted as `../?path=/docs/category-name--docs`)
  - Status indicators (WIP, complete)
- Handle category-specific formatting:
  - **Primitives**: Simple alphabetical list
  - **Components**: Grouped by functionality
  - **Compositions**: Grouped by use case
  - **Patterns**: Hierarchical by subcategory (intelligence, interaction, content, etc.)
  - **Concepts**: Thematic grouping
  - **Foundations**: Design system hierarchy

#### Template System
Category-specific templates with placeholder replacement:
```mdx
<!-- primitives.template.mdx -->
<Meta title="Primitives/Overview" />

# Primitives

{{DESCRIPTION}}

## Available Primitives

{{PRIMITIVE_LIST}}

---
*This page is auto-generated by the Storybook Overview Generator plugin.*
```

### 3. Configuration Options

#### Plugin Configuration (`vite.config.ts`)
```typescript
export default defineConfig({
  plugins: [
    storybookOverviewGenerator({
      // Required
      storiesPath: './src/stories',
      
      // Optional
      categories: ['primitives', 'components', 'compositions', 'patterns', 'concepts', 'foundations'],
      outputPattern: '{{category}}/Overview.mdx',
      watchMode: true, // Enable file watching in dev
      
      // Template customisation
      templates: {
        primitives: './custom-templates/primitives.mdx',
        // ... other overrides
      },
      
      // URL generation
      urlTransform: (category: string, name: string) => 
        `../?path=/docs/${category}-${name.toLowerCase().replace(/\s+/g, '-')}--docs`,
      
      // Filtering
      exclude: ['*.stories.tsx'], // Exclude certain patterns
      includeWIP: true, // Include WIP items marked with *
      
      // Sorting
      sortBy: 'alphabetical', // 'alphabetical' | 'modified' | 'custom'
      customSort: (a, b) => a.title.localeCompare(b.title),
      
      // Grouping (for complex categories like patterns)
      groupBy: {
        patterns: 'subcategory', // Group by subdirectory
        components: 'functionality',
      }
    })
  ]
})
```

### 4. Implementation Plan

#### Phase 1: Core Plugin Structure
1. **Setup plugin boilerplate**
   - Create plugin directory structure
   - Set up TypeScript configuration
   - Define plugin interface and types
   - Implement basic Vite plugin hooks

2. **Directory Scanner Implementation**
   - Recursive directory traversal
   - File type detection (.mdx, .stories.tsx, .md)
   - Metadata extraction from different file types
   - Handle nested directory structures

3. **Content Generator Implementation**
   - MDX template system
   - Link URL generation following Storybook conventions
   - Category-specific formatting logic
   - Content validation and error handling

#### Phase 2: Advanced Features
1. **Template System**
   - Default templates for each category
   - Custom template override support
   - Template variable replacement
   - Template validation

2. **Configuration System**
   - Plugin options interface
   - Configuration validation
   - Default configuration values
   - Runtime configuration updates

3. **File Watching**
   - Watch for file changes in stories directories
   - Incremental regeneration
   - Debounced updates
   - Build vs. dev mode behaviour

#### Phase 3: Enhanced Functionality
1. **Metadata Extraction**
   - Parse frontmatter from .mdx files
   - Extract descriptions from content
   - Handle Meta exports from .stories.tsx
   - Support for custom metadata fields

2. **Advanced Grouping & Sorting**
   - Hierarchical grouping for complex categories
   - Custom sorting algorithms
   - Status-based organisation (WIP, complete)
   - Dependency-based ordering

3. **Error Handling & Validation**
   - Comprehensive error messages
   - Validation of generated content
   - Graceful handling of malformed files
   - Development-time warnings

### 5. Plugin Integration

#### Vite Configuration
```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import { storybookOverviewGenerator } from './plugins/storybook-overview-generator'

export default defineConfig({
  plugins: [
    storybookOverviewGenerator({
      storiesPath: './src/stories',
      watchMode: process.env.NODE_ENV === 'development'
    })
  ]
})
```

#### Development Workflow
1. **Build Time**: Generate all overview pages
2. **Dev Mode**: Watch for changes and regenerate affected overviews
3. **Storybook Integration**: Seamless integration with existing Storybook setup
4. **Git Integration**: Generated files should be committed to version control

### 6. File Structure Impact

#### Generated Files
- `src/stories/primitives/Overview.mdx` (updated)
- `src/stories/components/Overview.mdx` (updated)
- `src/stories/compositions/Overview.mdx` (updated)
- `src/stories/patterns/Overview.mdx` (updated)
- `src/stories/concepts/Overview.mdx` (updated)
- `src/stories/foundations/Overview.mdx` (updated)

#### New Files
- `plugins/storybook-overview-generator/` (entire plugin directory)
- `templates/` (template files for customisation)

### 7. Testing Strategy

#### Unit Tests
- Directory scanning accuracy
- Metadata extraction from different file types
- URL generation following Storybook conventions
- Template rendering with various inputs

#### Integration Tests
- Full plugin execution with real directory structure
- Vite plugin lifecycle integration
- File watching and regeneration
- Error handling with malformed files

#### Manual Testing
- Verify generated overview pages in Storybook
- Test with existing project structure
- Validate links work correctly
- Check edge cases (empty directories, special characters)

### 8. Documentation Requirements

#### Plugin Documentation
- Installation and setup instructions
- Configuration options reference
- Template customisation guide
- Troubleshooting guide

#### Developer Documentation
- Plugin architecture overview
- Extension points for custom functionality
- Contributing guidelines
- API reference

### 9. Performance Considerations

#### Optimization Strategies
- Incremental regeneration (only changed categories)
- Caching of file metadata
- Debounced file watching
- Lazy loading of templates

#### Build Time Impact
- Minimal impact on build time
- Parallel processing where possible
- Efficient file system operations
- Memory-conscious metadata storage

### 10. Maintenance & Evolution

#### Version Control
- Plugin versioning strategy
- Generated file handling in git
- Migration guides for breaking changes
- Backwards compatibility considerations

#### Future Enhancements
- Integration with other documentation tools
- AI-powered description generation
- Advanced analytics and insights
- Cross-project component sharing

## Implementation Timeline

**Week 1**: Core plugin structure and directory scanner
**Week 2**: Content generator and basic template system
**Week 3**: File watching and Vite integration
**Week 4**: Advanced features and testing
**Week 5**: Documentation and polish

## Success Metrics

- **Automation**: 100% automated overview generation
- **Accuracy**: All existing components correctly listed
- **Performance**: <1s regeneration time for typical changes
- **Reliability**: Zero manual intervention required
- **Maintainability**: Easy to extend for new categories or formats

## Risks & Mitigations

**Risk**: Complex nested directory structures in patterns
**Mitigation**: Flexible scanner with configurable depth limits

**Risk**: Storybook URL format changes
**Mitigation**: Configurable URL transformation function

**Risk**: Performance impact on large codebases
**Mitigation**: Incremental updates and caching strategies

**Risk**: Integration conflicts with existing Storybook setup
**Mitigation**: Thorough testing and non-invasive implementation